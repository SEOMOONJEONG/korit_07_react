# Login Process ì§„í–‰
# REST API í˜¸ì¶œ
í˜„ì¬ ìƒí™©ì—ì„œ ë¡œê·¸ì¸ì„ ì„±ê³µí•œë‹¤ê³  í•˜ë”ë¼ë„ jwtë¥¼ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í–ˆì„ ë¿ì´ê³ , ì•„ì§ getCars()ì˜ ê²°ê³¼ê°’ì„ ê°€ì ¸ì˜¤ì§€ëŠ” ëª»í•©ë‹ˆë‹¤.

ì´ ì´ìœ ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Login ì»´í¬ë„ŒíŠ¸ì—ì„œ ì–»ì€ í† í°ì„ ê°€ì§€ë¡œ frontendìƒì—ì„œ Carlistë¥¼ ë¶€ëŸ¬ì˜¤ì§€ ëª»í•˜ê³  ìˆëŠ” ìƒí™©ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

carapi.tsì— getCars() í˜¸ì¶œì„ í•  ë•Œ ì–»ì–´ì˜¨ jwtë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
ê·¼ë° jwtToken ê°’ì´ ìƒê°í•´ë³´ë©´ .then()ì— ê±¸ë ¤ìˆê¸° ë•Œë¬¸ì— ì¼ì¢…ì˜ ì§€ì—­ë³€ìˆ˜ë¼ê³  ë³¼ ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤. ê·¸ë ‡ë‹¤ë©´ Login ì»´í¬ë„ŒíŠ¸ë¥¼ ë²—ì–´ë‚˜ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ì˜ë¯¸ê°€ ë  ê²ë‹ˆë‹¤.
ê·¸ëŸ¬ë©´ ì–˜ë¥¼ ì–´ë–»ê²Œ ëŒê³  ì™€ì„œ getCars() í•¨ìˆ˜ì— jwtê°’ì„ ë„£ì–´ì„œ ê°™ì´ GET ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆì„ì§€ ê·¸ëƒ¥ ê³ ë¯¼ë§Œ í•´ë³´ê² ìŠµë‹ˆë‹¤.

ìš°ë¦¬ê°€ sessionStorageì— êµ³ì´ setItemì„ í•œ ì´ìœ ì— ëŒ€í•´ì„œ ìƒê°í•´ë´ì•¼í•©ë‹ˆë‹¤. â†’ carapi.tsì—ì„œ ì“°ë ¤ê³ 

ê·¸ë˜ì„œ apië“¤ì— token ì§‘ì–´ë„£ëŠ”ê±° í•˜ê³  ë‚˜ì„œëŠ” ì¤‘ë³µ ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§í•  ì˜ˆì •ì…ë‹ˆë‹¤.
ì§€ê¸ˆ ë³´ë©´ ê²°ê³¼ì ìœ¼ë¡œ tokenì„ í•¨ìˆ˜ë“¤ì—ì„œ ì „ë¶€ ë‹¤ êº¼ë‚´ì“°ê³  ìˆëŠ” ì¤‘ì¸ë°ë‹¤ê°€ Authorization : token ë­ ì´ëŸ° ë¶€ë¶„ì´ ë°˜ë³µì ìœ¼ë¡œ ì“°ì´ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
// carapi.ts
import axios from "axios";
import { CarResponse, Car, CarEntity } from "../types";

export const getCars = async (): Promise<CarResponse[]> => {
    const token = sessionStorage.getItem('jwt');

    // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ìƒì— 'Bearer 'ê°€ í¬í•¨ë˜ì–´ìˆìŠµë‹ˆë‹¤. ê·¼ë° ì €í¬ê°€ Postmanì—ì„œ ìš”ì²­ ë‚ ë¦´ ë•Œ 'Bearer ' ë¶€ë¶„ì„ ë¹¼ë†“ê³  ë¶™ì—¬ë„£ê¸° í–ˆì—ˆë˜ ê²ƒì„ ë– ì˜¬ë ¤ì„œ
    // í”„ë¡ íŠ¸ ì—”ë“œ ìƒì—ì„œ 'Bearer 'ë¥¼ ì œê±°í•˜ê³ , ê·¸ê±¸ ê¸°ì¤€ìœ¼ë¡œ ìš”ì²­ì„ ë‚ ë ¸ìŠµë‹ˆë‹¤.
    const rawToken = token?.replace('Bearer ', '');
    const response = await axios.get(`${import.meta.env.VITE_API_URL}/api/cars`, {
        headers: { 'Authorization': `${rawToken}` }
    });

    return response.data._embedded.cars;    // ë‚´ë¶€ ë°°ì—´ë§Œ ê°€ì§€ê³ ì˜´.
}

export const deleteCar = async (link: string) : Promise<CarResponse> => {

    // chaining methodë¥¼ í™œìš©í•œ ì½”ë“œë„ í•˜ë‚˜ëŠ” ë‚¨ê²¨ë†“ê² ìŠµë‹ˆë‹¤.
    const token = sessionStorage.getItem('jwt')?.replace('Bearer ', '');
    const response = await axios.delete(link,  {
        headers: { 'Authorization': `${token}` }
    });

    return response.data    // ì „ë¶€ ë‹¤ ê°€ì§€ê³ ì˜´.
}

export const addCar = async (car: Car) : Promise<CarResponse> => {  
    const token = sessionStorage.getItem('jwt');
    const rawToken = token?.replace('Bearer ', '');
    const response = await axios.post(`${import.meta.env.VITE_API_URL}/api/cars`, car, {        // id ê°’ ì—†ì–´ì„œ ì§ì ‘ë¶ˆëŸ¬ì˜´
        headers: {
            'Content-Type': 'application/json',
            'Authorization': rawToken
        },
    });

    return response.data;
}

export const updateCar = async (carEntity: CarEntity) : Promise<CarResponse> => {
    const token = sessionStorage.getItem('jwt');
    const rawToken = token?.replace('Bearer ', '');
    const response = await axios.put(carEntity.url, carEntity.car, {        // id í¬í•¨ë˜ì–´ìˆê¸° ë•Œë¬¸ì— urlë¡œ idê°’ í¬í•¨í•´ì„œ ê·¸ëŒ€ë¡œ ë¶ˆëŸ¬ì˜´.
        headers: {
            'Content-Type': 'application/json',
            'Authorization': rawToken
        },
    });

    return response.data;
}
```
ì´ìƒì€ refactoring ì „ ë¶€ë¶„ì…ë‹ˆë‹¤. ìœ„ì— ë§í–ˆë–¤ ê²ƒì²˜ëŸ¼ tokenì€ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê³ , ì—¬ê¸°ì„œ Bearer ì ‘ë‘ì‚¬ë¥¼ ì œê±°í•˜ëŠ” ë¶€ë¶„, ê·¸ë¦¬ê³  headers ë‚´ì— 'Authorization': token ë¶€ë¶„ì´ ì¤‘ë³µë˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ë¶€ë¶„ì—ì„œ ì•Œì•„ì•¼ í•  ì ì€ Scope ê°œë…ì´ ë˜ê² ë„¤ìš”. ê° í•¨ìˆ˜ì˜ ë‚´ë¶€ì—ì„œ tokenì„ ì„ ì–¸í•˜ê³  Bearer ì ‘ë‘ì‚¬ë¥¼ ì œê±°í•˜ê³  ìˆê¸° ë•Œë¬¸ì— í•¨ìˆ˜ ë§ˆë‹¤ ì„ ì–¸ ë° ì´ˆê¸°í™”ë¥¼ í•˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.

## ì¤‘ë³µ ì½”ë“œ ë¦¬íŒ©í† ë§
```ts
// carapi.ts
import axios, { AxiosRequestConfig } from "axios";
import { CarResponse, Car, CarEntity } from "../types";

const getAxiosConfig = () : AxiosRequestConfig => {
    const token = sessionStorage.getItem('jwt')?.replace('Bearer ', '');

    return {
        headers: {
            'Authorization': token,
            'Content-Type': 'application/json',
        }
    }
}

export const getCars = async (): Promise<CarResponse[]> => {

    const response = await axios.get(`${import.meta.env.VITE_API_URL}/api/cars`, getAxiosConfig());

    return response.data._embedded.cars;    // ë‚´ë¶€ ë°°ì—´ë§Œ ê°€ì§€ê³ ì˜´.
}

export const deleteCar = async (link: string) : Promise<CarResponse> => {

    const response = await axios.delete(link, getAxiosConfig());

    return response.data    // ì „ë¶€ ë‹¤ ê°€ì§€ê³ ì˜´.
}

export const addCar = async (car: Car) : Promise<CarResponse> => {  
    const response = await axios.post(`${import.meta.env.VITE_API_URL}/api/cars`, car, getAxiosConfig());

    return response.data;
}

export const updateCar = async (carEntity: CarEntity) : Promise<CarResponse> => {
    const response = await axios.put(carEntity.url, carEntity.car, getAxiosConfig());

    return response.data;
}
```
tokenì„ ì§€ì—­ë³€ìˆ˜ â†’ ì „ì—­ë³€ìˆ˜ë¡œ ì„ ì–¸í•˜ì—¬ ì¤‘ë³µë˜ëŠ” ì½”ë“œë¥¼ ìˆ˜ì •í•¨.
ì´ìƒì—ì„œ ê³ ë ¤í•  ì ì€ getAxiosConfigì˜ return íƒ€ì…ìœ¼ë¡œ ì‚¬ìš©ëœ AxiosRequestConfig ì…ë‹ˆë‹¤.

- AxiosRequestConfig : Axios ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ HTTP ìš”ì²­ì„ ë§Œë“¤ ë•Œ ì‚¬ìš©ë˜ëŠ” êµ¬ì„± ê°ì²´ íƒ€ì… ì •ì˜ì— í•´ë‹¹í•©ë‹ˆë‹¤. ì¦‰, Axiosë¥¼ ê²½ìœ í•˜ì—¬ ìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•´ í•„ìš”í•œ _ëª¨ë“  ì˜µì…˜_ ì„ ë‹´ëŠ” interfaceì— í•´ë‹¹í•©ë‹ˆë‹¤.

- ì €í¬ëŠ” axios.post(), .get ... ê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ëŠ” ì¢€ ë” ê°€ë…ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ë°©ì‹ìœ¼ë¡œ _ë©”ì„œë“œ ë³„ ìš”ì²­_ ì— í•´ë‹¹í•©ë‹ˆë‹¤. ì´ ê²½ìš° endpoint ë‹¤ìŒì— ë‘ ë²ˆì§¸ argumentë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
1. ë©”ì„œë“œ ë³„ ìš”ì²­
```ts
// GET ìš”ì²­ì´ë¼ê³  ê°€ì •
axios.get('http://loscalhost:8080/api/cars', {headers: {'Authorization':token}});
```
2. ì¼ë°˜ì ì¸ ìš”ì²­ ë°©ì‹
```ts
axios({
  method: 'get',
  url: 'http://localhost:8080/api/cars', 
  headers: {
    'Authorization': token,
  }
});
```
ì´ìƒì˜ 1, 2 ê³¼ì • ì¤‘ì— return íƒ€ì…ì— ê°ì²´ í˜•íƒœë¡œ ì˜µì…˜ë“¤ì„ ë‹´ì„ ìˆ˜ ì‡ëŠ” ê²ƒì„ AxiosRequestConfigë¼ê³  í•©ë‹ˆë‹¤. ì €í¬ëŠ” 1 ë²ˆ ë°©ë²•ì„ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— getAxiosConfig() í•¨ìˆ˜ì˜ ì •ì˜ê°€ ê°„ë‹¨í•œ í¸ì— ì†í–ˆìŠµë‹ˆë‹¤. 2 ë²ˆ ë°©ë²•ì´ë©´ method í‚¤ì˜ valueë¥¼ ì§€ì •í•˜ëŠ”ê²Œ ë³µì¡í–ˆê² ë„¤ìš”.

ì¸í„°ì…‰í„°(interceptor)ì—ì„œì˜ í™œìš© : request interceptorëŠ” ìš”ì²­ì´ ì„œë²„ë¡œ ê°€ê¸° ì „ì— ê°€ë¡œì±„ì„œ êµ¬ì„±ì„ ìˆ˜ì •í•©ë‹ˆë‹¤. ì¦‰ getAxiosConfig() í•¨ìˆ˜ ìš”ì²­ì„ í•˜ê²Œë˜ë©´ ì²˜ìŒì—ëŠ” tokenì´ ì—†ëŠ” ìƒíƒœë¡œ DBê¹Œì§€ ê°€ê²Œ ë  ë»” í–ˆëŠ”ë°, ì–˜ê°€ ì¤‘ê°„ì— ê°€ë¡œì±„ì„œ headersë¥¼ ì¶”ê°€í•´ì¤€ë‹¤ëŠ” ì˜ë¯¸ê°€ ë˜ê² ìŠµë‹ˆë‹¤.

## Authentication ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í† ìŠ¤íŠ¸ ë©”ì‹œì§€ë¡œ ì‘ìš©í•˜ê² ìŠµë‹ˆë‹¤.
```tsx
<Snackbar 
  open={open}
  autoHideDuration={3000}
  onClose={() => setOpen(false)}
  message='ID í˜¹ì€ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤. ğŸ«¥'
/>
```
ë¼ê³  ì„¤ì •ì„ í–ˆë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ, ìš°ë¦¬ëŠ” setOpen(true)ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì´ í•„ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.
Login ì»´í¬ë„ŒíŠ¸ ì¤‘ ì–´ë–¤ ë™ì‘ì„ í–ˆì„ ë•Œ toast messageê°€ ì¶œë ¥ë˜ì–´ì•¼í•˜ë©°, ê·¸ë˜ì„œ setOpen(true) ì½”ë“œë¥¼ ì‚½ì…í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì„ ì–´ë””ì¼ê¹Œìš”.

```
shoppinglistì˜ Backend ì§œê¸°
  - Spring Initializr ë¶€í„°
todolistì˜ Frontend ì§œê¸°
  - vite project ìƒì„± ë¶€í„°
```
